sudo: required

dist: trusty

env:
  - VERSION=1.4
  - VERSION=1.5

before_install:
  - sudo apt-get -y purge docker-engine
  - bash <(curl -fsSL https://get.docker.com/)
  - docker version
  - docker network create --driver=bridge --subnet=192.168.0.0/16 --opt="com.docker.network.driver.mtu=1450" --opt="com.docker.network.bridge.name=redd0" nanobox
  - ifconfig
  - echo building $VERSION
  - docker pull nanobox/memcached:$VERSION || (docker pull nanobox/memcached:${VERSION}-beta; docker tag nanobox/memcached:${VERSION}-beta nanobox/memcached:${VERSION})

script: sudo stdbuf -oL test/run_all.sh $VERSION